<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meshtastic Network Dashboard</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Vis.js CSS - using a stable version -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <div class="title">üåê Meshtastic Dashboard</div>
            </div>
            <div class="header-center">
                <div class="header-search">
                    <div class="search-container">
                        <input type="text" class="header-search-input" id="nodeSearchInput" placeholder="Search node ID or name..." autocomplete="off">
                        <button class="header-search-button" onclick="searchNode()">üîç Search</button>
                        <div class="search-dropdown" id="searchDropdown"></div>
                    </div>
                </div>
                <div class="timeframe-selector">
                    <select id="timeframeSelect" class="timeframe-select" onchange="updateTimeframe()">
                        <option value="12">Last 12 hours</option>
                        <option value="24">Last 24 hours</option>
                        <option value="48" selected>Last 48 hours</option>
                        <option value="72">Last 72 hours</option>
                    </select>
                </div>
            </div>
            <div class="header-right">
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">Nodes</div>
                        <div class="stat-value" id="stat-nodes">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Connections</div>
                        <div class="stat-value" id="stat-connections">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Packets</div>
                        <div class="stat-value" id="stat-packets">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Active</div>
                        <div class="stat-value" id="stat-active">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="map-container">
            <div class="panel-title">üìç Node Locations <button class="fullscreen-btn" onclick="toggleFullscreen('map')" title="Toggle Fullscreen">‚õ∂</button></div>
            <div class="connection-status" id="connection-status">Connecting...</div>
            <div id="map"></div>
        </div>
        
        <div class="graph-container">
            <div class="panel-title">üîó Network Graph <button class="fullscreen-btn" onclick="toggleFullscreen('graph')" title="Toggle Fullscreen">‚õ∂</button></div>
            <div id="network"></div>
        </div>
        
        <div class="log-container">
            <div class="log-header">üì° Live Activity Feed</div>
            <div class="log-content" id="log-content">
                <div class="log-entry">
                    <span class="timestamp">Waiting for data...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Results Modal -->
    <div id="searchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Node Search Results</h2>
                <button class="modal-close" onclick="closeSearchModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="searchResults">
                    <!-- Search results will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Node Info Modal -->
    <div id="nodeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="nodeModalTitle">Node Information</h2>
                <button class="modal-close" onclick="closeNodeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="nodeModalContent">
                    <!-- Node details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Vis.js - using stable version that should definitely work -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.js"></script>
    
    <!-- Dashboard JavaScript -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
